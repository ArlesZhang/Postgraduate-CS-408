# 📘 用公式测量程序性能：来自408《计算机组成原理》的思考与延展

> 本笔记基于《Computer Organization and Design: The Hardware/Software Interface（计算机组成与设计：硬件/软件接口）》一书中的**程序执行时间测量公式**，并结合我的理解进行总结与拓展。

---

## 📌 1. 原始公式与内化表达

书中指出，一个可靠的性能测量方法是：**用实际程序的执行时间作为尺度**，其与计算机系统的多个关键指标相关：

$$
\frac{\text{Seconds}}{\text{Program}} = 
\frac{\text{Instructions}}{\text{Program}} \times 
\frac{\text{Clock Cycles}}{\text{Instruction}} \times 
\frac{\text{Seconds}}{\text{Clock Cycle}}
$$

---

我将其简化为如下记号，便于记忆与快速运算：

$$
\frac{S}{P} = \frac{I}{P} \times \frac{C}{I} \times \frac{S}{C}
$$

进一步表示为：

$$
\frac{S}{P} = \frac{I}{P} \times \text{CPI} \times \frac{1}{f}
$$

- 其中：
  - $S/P$：程序执行所需时间（秒/程序）
  - $I/P$：程序中包含的指令数（指令/程序）
  - $C/I$：每条指令平均使用的时钟周期（即 CPI）
  - $S/C$：每个时钟周期的时间（即 $1/f$，f 为时钟频率）

> ✅ **一句话总结**：程序运行时间 = 指令数 × CPI × 每个时钟周期耗时。

---

## ⚙️ 2. 从另一个角度：IPS 的联想与推导

我由上式进一步联想到另一性能指标：**IPS（Instructions per Second，指令吞吐率）**，即单位时间内执行的指令数：

$$
\text{IPS} = \frac{I}{S} = \frac{I}{C} \times \frac{C}{S}
= \frac{1}{\text{CPI}} \times f
$$

换句话说：

$$
\text{IPS} = \frac{1}{\text{CPI}} \times f
$$

- 可知：CPI 越小、频率越高，IPS 越大，系统越快。

> 💡 **思维启发**：
> - 在表达公式时，**能用乘法就不要用除法，能用加法就避免减法**，这更符合人类的正向思维逻辑（如数学中常常是正向设 x 解题而非逆推）。
> - 类似的，计算机体系结构设计中，也常常使用正向逻辑（例如流水线、预测、分支优化等），便于硬件实现与推理。

---

## 🔄 3. 性能测量的“两面性”：时间 vs 速率

我总结出这两个公式其实是**一体两面**的表达：

| 指标 | 含义 | 类比 | 常用公式 |
|------|------|------|----------|
| $S/P$ | 完成一个程序需要的总时间 | 干一项活需要多久 | $I/P \times CPI \times \frac{1}{f}$ |
| $IPS$ | 单位时间内能完成多少指令 | 单位时间内干了多少活 | $\frac{1}{CPI} \times f$ |

- $S/P$ 是“拉时间线”思维
- $IPS$ 是“看效率”思维

这让我更清楚地认识到，**性能测量公式并不神秘，本质就是工作量与时间的关系转化**。

---

## ✍️ 4. 总结（可复制、可类比、可迁移）

- ✅ **秒/程序 = 指令/程序 × 周期/指令 × 秒/周期**
- ✅ **IPS = 1/CPI × f**
- ✅ 性能衡量的核心问题就是：**单位时间内干多少活 vs 干一项活需要多少时间**
- ✅ 多用正向乘法表达，减少“除法”与逆向理解
- ✅ 可类比现实中的“搬砖”：搬一块砖花多久，和一分钟内能搬多少砖，本质上是一回事

---

## 🧠 延伸思考（for advanced learners）

- 如何将 CPI 分解为不同指令类型的加权平均？
- 时钟频率 f 提升后，对功耗和散热的影响如何？
- 除了 IPS，还有哪些反映系统吞吐能力的指标？
- 如何用 benchmark 工具测量现实程序的 CPI 和执行时间？

---

> 📂 本笔记为本人在学习《计算机组成与设计》过程中的阶段性总结，欢迎在 [GitHub Discussions](#) 中交流你的思考。
